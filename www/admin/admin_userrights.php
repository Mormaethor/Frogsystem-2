<?php
///////////////////////
//// Rechte Array /////
///////////////////////

$tmp[perm] = "perm_allconfig";
$tmp[description] = "Seitenkonfiguration";
$all_perms[] = $tmp;

$tmp[perm] = "perm_allannouncement";
$tmp[description] = "Ankündigungen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_allphpinfo";
$tmp[description] = "PHP Info";
$all_perms[] = $tmp;

$tmp[perm] = "perm_editorconfig";
$tmp[description] = "Editor Konfiguration";
$all_perms[] = $tmp;

$tmp[perm] = "perm_editordesign";
$tmp[description] = "Editor Darstellung";
$all_perms[] = $tmp;

$tmp[perm] = "perm_editorsmilies";
$tmp[description] = "Smilie Verwaltung";
$all_perms[] = $tmp;

$tmp[perm] = "perm_editorfscodes";
$tmp[description] = "FSCode Verwaltung";
$all_perms[] = $tmp;

$tmp[perm] = "perm_includesadd";
$tmp[description] = "Includes hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_includesedit";
$tmp[description] = "Includes bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_statview";
$tmp[description] = "Statistik anzeigen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_statedit";
$tmp[description] = "Statistik bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_statref";
$tmp[description] = "Referrer Statistik";
$all_perms[] = $tmp;

$tmp[perm] = "perm_statspace";
$tmp[description] = "Speicherplatz Statistik";
$all_perms[] = $tmp;



$tmp[perm] = "perm_newsadd";
$tmp[description] = "News schreiben";
$all_perms[] = $tmp;

$tmp[perm] = "perm_newsedit";
$tmp[description] = "News bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_newscatadd";
$tmp[description] = "News Kategorien hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_newscat";
$tmp[description] = "News Kategorien bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_newsconfig";
$tmp[description] = "News Konfiguration";
$all_perms[] = $tmp;

$tmp[perm] = "perm_artikeladd";
$tmp[description] = "Artikel schreiben";
$all_perms[] = $tmp;

$tmp[perm] = "perm_artikeledit";
$tmp[description] = "Artikel bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_polladd";
$tmp[description] = "Umfragen hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_polledit";
$tmp[description] = "Umfragen bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_pressadd";
$tmp[description] = "Presseberichte hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_pressedit";
$tmp[description] = "Presseberichte bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_cimgadd";
$tmp[description] = "Inhalts-Bilder hochladen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_cimgedit";
$tmp[description] = "Inhalts-Bilder verwalten";
$all_perms[] = $tmp;



$tmp[perm] = "perm_gallerycatadd";
$tmp[description] = "Galerie Kategorien hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_gallerycat";
$tmp[description] = "Galerie Kategorien bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_galleryconfig";
$tmp[description] = "Galerie Konfiguration";
$all_perms[] = $tmp;

$tmp[perm] = "perm_screenadd";
$tmp[description] = "Galerie Bilder hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_screenedit";
$tmp[description] = "Galerie Bilder bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_wpadd";
$tmp[description] = "Wallpaper hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_wpedit";
$tmp[description] = "Wallpaper bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_randomcat";
$tmp[description] = "Zufallsbilder Kategorien auswählen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_randomadd";
$tmp[description] = "Zeitgesteuerte Zufallsbilder hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_randomedit";
$tmp[description] = "Zeitgesteuerte Zufallsbilder bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_randomconfig";
$tmp[description] = "Zufallsbil Konfiguration";
$all_perms[] = $tmp;

$tmp[perm] = "perm_dladd";
$tmp[description] = "Downloads hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_dledit";
$tmp[description] = "Downloads bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_dlcatadd";
$tmp[description] = "Download Kategorien hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_dlcat";
$tmp[description] = "Download Kategorien bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_dlconfig";
$tmp[description] = "Download Konfiguration";
$all_perms[] = $tmp;



$tmp[perm] = "perm_partneradd";
$tmp[description] = "Partnerseiten hinzuügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_partneredit";
$tmp[description] = "Partnerseiten verwalten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_partnerconfig";
$tmp[description] = "Partnerseiten Konfiguration";
$all_perms[] = $tmp;

$tmp[perm] = "perm_shopadd";
$tmp[description] = "Shop Artikel hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_shopedit";
$tmp[description] = "Shop Artikel bearbeiten";
$all_perms[] = $tmp;



$tmp[perm] = "perm_designadd";
$tmp[description] = "Designs erstellen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_designedit";
$tmp[description] = "Designs verwalten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_all";
$tmp[description] = "Template bearbeiten: Allgemein";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_artikel";
$tmp[description] = "Template bearbeiten: Artikel";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_css";
$tmp[description] = "Template bearbeiten: CSS";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_dl";
$tmp[description] = "Template bearbeiten: Downloads";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_email";
$tmp[description] = "Template bearbeiten: Emailvorlagen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_gallery";
$tmp[description] = "Template bearbeiten: Galerie";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_news";
$tmp[description] = "Template bearbeiten: News";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_partner";
$tmp[description] = "Template bearbeiten: Partnerseiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_poll";
$tmp[description] = "Template bearbeiten: Umfragen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_random";
$tmp[description] = "Template bearbeiten: Zufallsbild";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_shop";
$tmp[description] = "Template bearbeiten: Shop";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_user";
$tmp[description] = "Template bearbeiten: User";
$all_perms[] = $tmp;

$tmp[perm] = "perm_template_wp";
$tmp[description] = "Template bearbeiten: Wallpaper";
$all_perms[] = $tmp;



$tmp[perm] = "perm_useradd";
$tmp[description] = "User hinzufügen";
$all_perms[] = $tmp;

$tmp[perm] = "perm_useredit";
$tmp[description] = "User bearbeiten";
$all_perms[] = $tmp;

$tmp[perm] = "perm_userrights";
$tmp[description] = "Userrechte";
$all_perms[] = $tmp;

$tmp[perm] = "perm_userlistconfig";
$tmp[description] = "Userliste Konfiguration";
$all_perms[] = $tmp;

$tmp[perm] = "perm_map";
$tmp[description] = "Community Map";
$all_perms[] = $tmp;

$tmp[perm] = "perm_profiledit";
$tmp[description] = "Profil bearbeiten";
$all_perms[] = $tmp;



///////////////////////
//// Rechte ändern ////
///////////////////////

if (isset($_POST[userid]))
{
    settype($_POST[userid], 'integer');
    if ($_POST[userid] != 1 AND $_POST[userid] != $_SESSION[user_id])
    {
        foreach($all_perms AS $value)
        {
            $_POST[$value[perm]] = isset($_POST[$value[perm]]) ? 1 : 0;
            $update = "UPDATE fs_permissions
                       SET $value[perm] = '".$_POST[$value[perm]]."'
                       WHERE user_id = $_POST[userid]";
            mysql_query($update, $db);
        }
        systext('User wurde geändert');
    }
    else
    {
        systext("Dieser User kann nicht bearbeitet werden!");
    }
}
  
///////////////////////
/// Rechte editieren //
///////////////////////

elseif (isset($_POST[edituserid]))
{
    settype($_POST[edituserid], 'integer');
    $userindex = mysql_query("SELECT user_name FROM fs_user WHERE user_id = $_POST[edituserid]", $db);
    $dbusername = mysql_result($userindex, 0, "user_name");

    $index = mysql_query("SELECT * FROM fs_permissions WHERE user_id = $_POST[edituserid]", $db);
    $perm_arr = mysql_fetch_assoc($index);

    foreach($all_perms AS $value)
    {
        $perm_arr[$value[perm]] = ($perm_arr[$value[perm]] == 1) ? 'checked="checked"' : "";
    }
    
    echo'
          <form action="'.$PHP_SELF.'" method="post">
          <input type="hidden" value="userrights" name="go">
          <input type="hidden" value="'.session_id().'" name="PHPSESSID">
          <input type="hidden" value="'.$_POST[edituserid].'" name="userid">
          <table border="0" cellpadding="0" cellspacing="0" align="center" width="600">
            <tr>
              <td class="config" colspan="2" valign="top">
                <b>Rechte für '.$dbusername.' einstellen</b><br /><br />
              </td>
            </tr>
            <tr>
              <td width="50%">';
              
    $per_col = ceil(count($all_perms)/2);
    $i=0;
    foreach($all_perms AS $value)
    {
        $i++;
        if ($i==1) {echo'<table border="0" cellpadding="1" cellspacing="0">';}
        echo'<tr>
               <td>
                 <input type="checkbox" style="vertical-align:bottom;" name="'.$value[perm].'" value="1" '
                 .$perm_arr[$value[perm]].'>
               </td>
               <td style="font-size:8pt; font-family:Verdana;" width="100%">
                 '.$value[description].'
               </td>
             </tr>';
        if ($i==$per_col) {echo'</table></td><td width="50%"><table border="0" cellpadding="1" cellspacing="0">';}
    }
              
    echo'       </table>
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <br /><br />
                <input type="submit" class="button" value="Absenden">
              </td>
            </tr>
         </table>
         </form>';
}

///////////////////////
/// User auswählen ////
///////////////////////

else
{
    echo'
          <form action="'.$PHP_SELF.'" method="post">
          <input type="hidden" value="userrights" name="go">
          <input type="hidden" value="'.session_id().'" name="PHPSESSID">
          <table border="0" cellpadding="2" cellspacing="0" width="600">
           <tr>
            <td align="center" class="config" width="50%">Username</td>
            <td align="center" class="config" width="50%">bearbeiten</td>
           </tr>
    ';
    $index = mysql_query("SELECT user_id, user_name
                           FROM fs_user
                           WHERE is_admin = 1 AND user_id != 1 AND user_id != $_SESSION[user_id]
                           ORDER BY user_name", $db);
    while ($user_arr = mysql_fetch_assoc($index))
    {
        echo'
           <tr>
            <td class="configthin">'.killhtml($user_arr[user_name]).'</td>
            <td class="config"><input type="radio" name="edituserid" value="'.$user_arr[user_id].'"></td>
           </tr>
        ';
    }
    if (mysql_num_rows($index) <= 0) {
        echo'
           <tr>
            <td class="configthin" colspan="2"><br />Keine User gefunden!</td>
           </tr>
        ';
    }
    echo'
           <tr><td colspan="3">&nbsp;</td></tr>
           <tr>
            <td colspan="2"><input class="button" type="submit" value="editieren"></td>
           </tr>
          </table>
          </form>
    ';
}
?>